BITS 64
%use altreg

%define loop_check_pass             0x10f29a27

; Input :
; - r10 : buff addr
; - r11 : buff_len addr
; - r12 : pwd_len addr

; Store input password
; read syscall
jmp .s1
db 0x6e,0xc2,0xa1,0xc2,0x26,0x50,0x6b,0x5f,0x7c,0x6a,0x6f,0xda,0x18,0x23,0xfc,0x44,0x6c
.s1:
mov rsi, r10 ; char *
jmp .s2
db 0xb0,0x07,0x71,0x65,0x7b
.s4:
mov rdx, r11 ; len
jmp .end1
db 0x20,0x18,0x61,0xa2,0x38,0x3c,0x33,0xdf,0x5e
.s2:
mov rax, 0 ; read
jmp .s3
db 0xf1,0x82,0x91,0x6a,0xbb,0xe0,0x00,0xbe,0x5c,0x00
.s3:
mov rdi, 0 ; stdin
jmp .s4
db 0x66,0x5c,0x3c,0x4b,0xb1,0x40,0x60
.end1:
syscall

; Store password length on .bss
dec rax
dec rax
mov [r12], rax
mov r15d, loop_check_pass

; Clear registers
xor rcx, rcx
